---
title: 光栅化渲染(5)-透视矫正
date: 2019-09-02 20:57:17
categories:
- Computer Graphics
- 光栅化渲染
tags:
---

　　*由于投影后比例的变化，在成像平面上插值计算出的颜色等属性值实际上也是存在偏差的。*
<!--more-->

# 透视矫正
　　前面我们提到可以用重心坐标的方法来对三角形内部的点做属性的插值，来赋予各个像素相应的颜色等属性：

$$
C_p = \lambda_0 * C_0 + \lambda_1 * C_1 + \lambda_2 * C_2
$$

　　其中$(\lambda_0, \lambda_1, \lambda_2)$为投影平面上插值这一点的重心坐标。

　　但是在[深度检测](https://ain-crad.github.io/2019/08/27/%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93-4-%E6%B7%B1%E5%BA%A6%E6%A3%80%E6%B5%8B/#more)中我们考虑到由于投影后的比例变化，所以我们不能把投影平面上三角形某点的重心坐标直接作为空间三角形上对应点的重心坐标（Figure 1)。**因此上面的颜色插值实际上也是存在偏差的。**

![figure 1](/figure1.png)
<center>Figure 1</center>

　　我们通过投影平面上三角形的重心坐标推出了计算对应空间点深度的公式：

$$
\cfrac{1}{Z} = \cfrac{1}{Z_0}(1 - q) + \cfrac{1}{Z_1}q
$$

　　现在我们可以通过深度来得到**矫正后的**颜色、纹理、法向量等其它空间点的属性（*以颜色为例推导*）。
　　如图（Figure 2），假设三角形上两点的深度分别为 $Z_0$ 和 $Z_1$，它们的颜色属性分别为 $C_0$ 和 $C_1$，连接这两点，我们可以对连线上的任意一点做深度和颜色的插值。

![figure 2](/figure2.png)
<center>Figure 2</center>

　　由于深度和颜色除了*属性名称*外没有什么不同，所以它们的插值应该是相互之间成比例的（Equation 1）：

$$
\cfrac{Z-Z_0}{Z_1-Z_0} = \cfrac{C-C_0}{C_1-C_0}
$$

　　由深度公式我们可以得到 $Z$ 的表达式（Equation 2）：

$$
Z = \cfrac{1}{\cfrac{1}{Z_0}(1 - q) + \cfrac{1}{Z_1}q}
$$

　　把（Equation 2）带入（Equation 1）左式中化简得：

![formula1](/formula1.png)

　　现在我们可以求得 $C$ 的表达式：

![formula2](/formula2.png)

　　进一步我们可以从右式中提出 $Z$，得到更简洁的形式：

![formula3](/formula3.png)

　　**至此，我们得到了矫正后的颜色属性。**同样的方法可以用来矫正插值点的纹理坐标、法向量等其它属性。