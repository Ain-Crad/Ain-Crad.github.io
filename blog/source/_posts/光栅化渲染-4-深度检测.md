---
title: 光栅化渲染(4)-深度检测
date: 2019-08-27 20:08:56
categories:
- Computer Graphics
- 光栅化渲染
tags:
---

![depth](/depth.png)

　　*如何确定投影区域内每个像素对应的空间物体上一点的深度是本节主要讨论的内容。*

# Z-Buffer
　　在[光栅化算法总述](https://ain-crad.github.io/2019/08/10/%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93-1-%E7%AE%97%E6%B3%95%E6%80%BB%E8%BF%B0/#more)里我们提到当有多个三角形相互重叠时，它们之上的某些点可能会投影到同一个像素位置，我们要通过``z-buffer``方法来确定这些点的深度大小关系，从而决定像素显示哪一点的颜色。
　　``z-buffer``是一个二维矩阵，矩阵元素初始化为一个较大的值，当遍历三角面片进行投影时不断更新元素值，用来记录每个像素对应的距离相机最近的空间物体上一点的深度。
　　关于如何求解每个像素对应的空间深度值，首先想到的可能是借助上一节提到的**重心坐标**插值的方法。但是由于投影后的比例变化（Figure 1），我们不能直接把投影平面上三角形的面积比作为空间三角形的面积比来得到重心坐标。

![figure 1](/figure1.png)
<center>Figure 1</center>

　　我们的目标是由投影平面上三角形的重心坐标来推出空间三角形的重心坐标。在[透视投影](https://ain-crad.github.io/2019/08/11/%E5%85%89%E6%A0%85%E5%8C%96%E6%B8%B2%E6%9F%93-2-%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1/)部分我们得到了投影坐标：

$$
\begin{align}
&P_{screen}.x = \cfrac{near * P_{camera}.x}{-P_{camera}.z} \\\\
&P_{screen}.y = \cfrac{near * P_{camera}.y}{-P_{camera}.z} \\\\
&P_{screen}.z = -P_{camera}.z
\end{align}
$$

　　*注意与之前不同的是，投影之后我们仍然保留空间点的z坐标，利用它们还原计算空间三角形的重心坐标。*
　　